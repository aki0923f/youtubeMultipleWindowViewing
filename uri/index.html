<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Multi YouTube Viewer</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;
    }
    .top-bar {
      display: flex;
      align-items: center;
      padding: 10px;
      gap: 10px;
      background-color: #111;
      flex-wrap: wrap;
    }
    .top-bar input {
      padding: 5px;
      width: 300px;
      border-radius: 4px;
      border: none;
    }
    .top-bar button {
      padding: 6px 10px;
      background-color: #444;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .video-container {
      display: grid;
      justify-content: center;
      align-content: center;
      height: calc(100vh - 60px);
      width: 100vw;
      overflow: hidden;
      gap: 5px;
      padding: 5px;
      box-sizing: border-box;
    }
    .video-wrapper {
      position: relative;
      background-color: #000;
    }
    .video-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
      aspect-ratio: 16 / 9;
      display: block;
    }
    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <input type="text" id="urlInput" placeholder="YouTube URLを入力">
    <button onclick="addVideo()">＋</button>
    <button onclick="clearAll()">全削除</button>
  </div>
  <div class="video-container" id="videoContainer"></div>

  <script>
    let videoList = [];

    function saveState() {
      localStorage.setItem('videoList', JSON.stringify(videoList));
    }

    function loadState() {
      const saved = localStorage.getItem('videoList');
      if (saved) {
        videoList = JSON.parse(saved);
        updateDisplay();
      }
    }

    function getEmbedURL(url) {
      try {
        const videoId = new URL(url).searchParams.get("v") || url.split("/").pop();
        return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
      } catch {
        return null;
      }
    }

    function addVideo() {
      const url = document.getElementById("urlInput").value.trim();
      const embed = getEmbedURL(url);
      if (embed) {
        videoList.push({ url, embed });
        document.getElementById("urlInput").value = "";
        updateDisplay();
        saveState();
      } else {
        alert("有効なYouTube URLを入力してください");
      }
    }

    function removeVideo(index) {
      videoList.splice(index, 1);
      updateDisplay();
      saveState();
    }

    function clearAll() {
      videoList = [];
      updateDisplay();
      saveState();
    }

    function updateDisplay() {
      const container = document.getElementById("videoContainer");
      container.innerHTML = "";

      const count = videoList.length;
      let rows = 1, cols = 1;

      if (count === 1) {
        rows = 1; cols = 1;
      } else if (count === 2) {
        rows = 1; cols = 2;
      } else if (count <= 4) {
        rows = 2; cols = 2;
      } else if (count <= 6) {
        rows = 2; cols = 3;
      } else {
        rows = 3; cols = 3;
      }

      container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      container.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

      videoList.forEach((video, i) => {
        const wrapper = document.createElement("div");
        wrapper.className = "video-wrapper";
        const iframe = document.createElement("iframe");
        iframe.src = video.embed;
        const btn = document.createElement("button");
        btn.textContent = "−";
        btn.className = "remove-btn";
        btn.onclick = () => removeVideo(i);
        wrapper.appendChild(iframe);
        wrapper.appendChild(btn);
        container.appendChild(wrapper);
      });
    }

    window.onload = loadState;
  </script>
</body>
</html>
